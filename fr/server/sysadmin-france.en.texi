\input texinfo                @c -*- Texinfo -*-
@c %**start of header
@setfilename sysadmin-france.info
@settitle @code{System Administration France}
@setchapternewpage odd
@c %**end of header

@set RCSID $Id: sysadmin-france.en.texi,v 1.13 2001-04-22 00:44:50 loic Exp $
@set VERSION 1.0

@c Combine the variable and function indices:
@syncodeindex vr fn
@c Combine the program and concept indices:
@syncodeindex pg cp

@titlepage
@title System Administration France
@subtitle Information specific to GNU and FSF machines in France
@subtitle @code{Sysadmin France} Version @value{VERSION}
@author Loic Dachary
@page
@vskip 0pt plus 1filll

 Permission is granted to make and distribute verbatim copies of
 this manual provided the copyright notice and this permission notice
 are preserved on all copies.

 Permission is granted to copy and distribute modified versions of this
 manual under the conditions for verbatim copying, provided that the entire
 resulting derived work is distributed under the terms of a permission
 notice identical to this one.

 Permission is granted to copy and distribute translations of this manual
 into another language, under the above conditions for modified versions,
 except that this permission notice may be stated in a translation approved
 by the Free Software Foundation.
@end titlepage
@page

@ifnottex
@node Top, Introduction, (dir), (dir)
@top Sysadmin France

This document is for system administrators, webmasters and users of GNU
and FSF machines in France.

@end ifnottex

@menu
* Introduction::                
* Accounts::                    
* Web::                         
* Private Data::                
* System::                      
* Concept Index::               
* Name Index::                  

@detailmenu
 --- The Detailed Node Listing ---

Accounts

* System Passwords::            
* Account Create::              
* Account Access::              
* Account Update::              
* Account Delete::              
* Cron Job::                    

Web

* Overview::                    
* Virtual Hosts::               
* Editing the Web::             
* Update from CVS::             
* Nightly script::              

System

* Security::                    
* Statistics::                  

Security

* Firewall::                    

Statistics

* Installation::                
* Output::                      

@end detailmenu
@end menu

@node Introduction, Accounts, Top, Top
@chapter Introduction

No information on the philosophical and political goals of the
@uref{http://www.fsfeurope.org/,,FSF Europe} in general and the
@uref{http://france.fsfeurope.org/,,FSF France} in particular can be
found in this document. 

The machines donated to FSF France and hosted in France are part of the
set of machines available to the GNU project. As such they follow the
same rules and the same policy.

In many aspects, the GNU way of doing things needs to be improved. When
this is the case the idea is to coordinate with the GNU volunteers in
charge of a specific aspect in order to improve the system. Doing so is
a lot easier than contributing to a software. It may sometime be
furstrating to stick to the GNU policy because it is easier to have a
quick and nice result by inventing something completly new. The Web is
probably the most striking example. However, since we claim to be part
of the GNU project we don't really have the option to fork something of
our own and leave the GNU project behind. Even if it means that we will
go slower, coordination with and improvement of the GNU project as a
whole should be our goal.

Close cooperation with the GNU project also makes some things a lot
easier. The account creation process, the management of the HTML tree
from CVS, the DNS hosting, mailing lists etc. are facilities we do not
need to re-implement. When installing something entirely new on the FSF
France machines, it is important to send a note on the relevant mailing
lists in advance. This prevents possible duplication of the effort and
greatly increases the chances that the GNU project will be able to
re-use the new facility.

Reference documents describing the GNU environment are
@uref{http://www.gnu.org/server/standards/,,standards} for webmaster
information, @file{fencepost.gnu.org:/gd/gnuorg/sysadmin/sysadmin.texi}
for system administration information and the
@uref{http://savannah.gnu.org/savannah.html,,Savannah admin guide} for
usage of the SourceForge clone.

@node Accounts, Web, Introduction, Top
@chapter Accounts

@menu
* System Passwords::            
* Account Create::              
* Account Access::              
* Account Update::              
* Account Delete::              
* Cron Job::                    
@end menu

@node System Passwords, Account Create, Accounts, Accounts
@section System Passwords

If you need the password of system users such as root or www you
should ask to the following persons:

@itemize

@item @email{rq@@lolix.org,Rodolphe Quiedeville}

@item @email{loic@@gnu.org,Loic Dachary}

@end itemize

@node Account Create, Account Access, System Passwords, Accounts
@section Account Create

@cindex shell account
@cindex fsffr and shell account

The user accounts on @code{france.fsfeurope.org} are managed with
@uref{http://savannah.gnu.org/,,Savannah}. If someone need a shell
account on @code{france.fsfeurope.org} he has to get an account on
@uref{http://savannah.gnu.org/,,Savannah} first. Then he should send
a mail to one of the project administrators of the 
@uref{http://savannah.gnu.org/projects/fsffr/,,fsffr} project. The
project administrator adds him as a member of the 
@uref{http://savannah.gnu.org/projects/fsffr/,,fsffr} project. Within
24 hours a cron job on @code{france.fsfeurope.org} will fetch the
new user from Savannah and create the account. 

@node Account Access, Account Update, Account Create, Accounts
@section Account Access

@cindex shell account ssh
@cindex ssh shell account
@cindex ssh public key
@cindex password ssh
@cindex ssh and password 
Once the account is created, access to the machine is available using
ssh and a public key. The Savannah password will not work on 
@code{france.fsfeurope.org}. When logged on 
@uref{http://savannah.gnu.org/projects/fsffr/,,fsffr} it is possible
to register one or more public key at 
@uref{http://savannah.gnu.org/account/editsshkeys.php,,Edit SSH Keys}. 

@node Account Update, Account Delete, Account Access, Accounts
@section Account Update

@cindex public key update
@cindex ssh public key update
Once a day the ssh public keys of every account on
@code{france.fsfeurope.org} are updated from the information fetched on
Savannah. If the @file{authorized_keys} file of a user is manualy updated,
it will be overwritten. 

@node Account Delete, Cron Job, Account Update, Accounts
@section Account Delete

When a user is not listed anymore in the 
@uref{http://savannah.gnu.org/projects/fsffr/,,fsffr}, its account is
disabled on @code{france.fsfeurope.org}. The home directory is not 
deleted and if the user is added again at a later time, he will retrieve
his former home directory. 

@node Cron Job,  , Account Delete, Accounts
@section Cron Job

The @file{/usr/local/bin/savannah_users} script does the update. It
is run from the @file{/etc/cron.d/savannah_users} cron file and spits
log information in @file{/var/log/savannah_users.log}. The log file
is rotated according to the @file{/etc/logrotate.d/savannah_users}
specification.

Savannah does not serve account information anonymously. The 
@code{france.fsfeurope.org} machine is explicitly allowed to retrieve
the relevant information in XML. For more information check the
@uref{http://savannah.gnu.org/savannah.html#Account%20Management,,Account Management} chapter of the Savannah documentation.

@node Web, Private Data, Accounts, Top
@chapter Web

@menu
* Overview::                    
* Virtual Hosts::               
* Editing the Web::             
* Update from CVS::             
* Nightly script::              
@end menu

@node Overview, Virtual Hosts, Web, Web
@section Overview

The FSF Europe web sites are stored in CVS on the GNU machines. They
can be edited from there and the france.fsfeurope.org has a local copy
of all the pages that are updated every hour. The primary purpose of
the france.fsfeurope.org machine is to host the FSF France web site,
data and programs. However every web site related to the GNU project
and friends of the GNU project are invited to use the machine for web
hosting if they need it.

@node Virtual Hosts, Editing the Web, Overview, Web
@section Virtual Hosts

The @file{/etc/apache/httpd.conf} was configured with virtual hosts. It
handles the following domain names:

@table @samp
@item france.fsfeurope.org
with a document root at @file{/var/www/france.fsfeurope.org}
that points to @file{/home/www/www.gnu.org/fsfe/fr}.

@item www.france.fsfeurope.org, fr.fsf.org, www.fr.fsf.org
with a redirect to france.fsfeurope.org

@item fr.gnu.org
with a document root at @file{/var/www/www.gnu.org}
that points to @file{/home/www/www.gnu.org}.

@end table

All new domains should use a similar policy, that will help keeping
things simple.

@node Editing the Web, Update from CVS, Virtual Hosts, Web
@section Editing the Web

@cindex fsfe project
@cindex edit france.fsfeurope.org

All users registered in the
@uref{http://savannah.gnu.org/projects/fsfe/,,FSF Europe} project can
edit the HTML repository using CVS/SSH. Instructions on how to do so can
be found on @uref{http://savannah.gnu.org/cvs/?group_id=53,,Savannah}.
The modified files will be updated on france.fsfeurope.org within one
hour. They will be available immediately after a commit on
http://www.gnu.org/fsfe/ which is convenient for testing.

@node Update from CVS, Nightly script, Editing the Web, Web
@section Update from CVS

@cindex www.gnu.org
@cindex france.fsfeurope.org updates
@cindex www.fsfeurope.org updates

A @code{cvs update} is done every hour in the
@file{/home/www/www.gnu.org/fsfe} directory by the
@file{/etc/cron.d/www} user crontab.  The logs of the update are stored
in @file{/var/log/www.log} and rotated by
@file{/etc/logrotate.d/www}. 

@node Nightly script,  , Update from CVS, Web
@section Nightly script

The @file{/home/www/bin/nightly} script is run daily and is in charge of
the following:

@itemize @bullet

@item Run @code{cvs update} in the @file{/home/www/www.gnu.org} directory.

@item Update the symbolic links according to the content of the
@file{.symlinks} files. See the @uref{http://www.gnu.org/server/standards/README.html#SEC01,,Symbolic Links} chapter of the webmaster guidelines for
detailed information.

@item Run the @code{all} goal for each Makefile in the directory tree. For
instance, if @code{about/Makefile} exists, then @code{make -C about all} is
run. 

@end itemize

The logs of the nightly script are stored in @file{/var/log/nightly.log}
and rotated by @file{/etc/logrotate.d/nightly}.

@node Private Data, System, Web, Top
@chapter Private Data

Most if not all the private data of the FSF France is handled by the
@uref{http://savannah.gnu.org/projects/fsfeprivate,,FSF Europe Private
Data} project on Savannah. Its access is restricted to its members only,
there is no anonymous access. If you need to have access to this
repository write to @email{team@@fsfeurope.org,FSF Europe Team} or
@email{france@@fsfeurope.org,,FSF France}.

@node System, Concept Index, Private Data, Top
@chapter System

@menu
* Security::                    
* Statistics::                  
@end menu

@cindex security
@node Security, Statistics, System, System
@section Security

@menu
* Firewall::                    
@end menu

@cindex firewall
@node Firewall,  , Security, Security
@subsection Firewall

A shell script applies filtering rules, it's located in
@file{/etc/init.d/firewall}. This script is compatible with kernel 2.2
and 2.4 and detects the kernel version using @file{uname}. @file{ipchains} is
used with 2.2 and @file{iptables} with 2.4.

Warning : only the ipchains (2.2) section is well configured.

The policy applied is to close all TCP/UDP port by default and open only
the ones we need.

@cindex statistics mrtg
@node Statistics,  , Security, System
@section Statistics

Systems statistics are generated with mrtg
@uref{http://ee-staff.ethz.ch/~oetiker/webtools/mrtg/}

@menu
* Installation::                
* Output::                      
@end menu

@node Installation, Output, Statistics, Statistics
@subsection Installation

mrtg and addons have been installed with apt-get, two packages :

@itemize
@item
mrtg version 2.8.9-1
@item
mrtgutils version 0.2
@end itemize

Some more scripts are used, they are located in @file{/usr/local/bin},
they are coming from @uref{http://mrtg.xidus.net/}

@itemize
@item
swapstat.sh
@item
stat.pl
@end itemize


@node Output,  , Installation, Statistics
@subsection Output

Output dir is @file{/var/www/france.fsfeurope.org/mrtg/}

@node Concept Index, Name Index, System, Top
@unnumbered Index of Concepts

@printindex cp

@node Name Index,  , Concept Index, Top
@unnumbered Index of File Names

@printindex fn

@summarycontents
@contents
@bye

